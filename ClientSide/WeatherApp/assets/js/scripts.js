//const API_URL = "api.openweathermap.org/data/2.5/forecast?lat={lat}&lon={lon}&appid={API key}";
const API_KEY = "9e8ebfe405aaed9187c06eb203742594";
const IPAPI = "http://ip-api.com/json/";



function GetWeatherByCity(cityname) {
    let APIURL = `https://api.openweathermap.org/data/2.5/weather?q=${cityname}&appid=${API_KEY}`;
    fetch(APIURL)
    .then(function(responce) {
        return responce.json();
    }).then(function(data) {
        console.log(data);
        ShowDataOnPage(data);
    }).catch(function(error) {
        console.log(error);
    });
}

function LoadCityData() {
    const CITY_NAMES = [
        "Abidjan",
        "Abu Dhabi",
        "Abuja",
        "Accra",
        "Addis Ababa",
        "Ahmedabad",
        "Aleppo",
        "Alexandria",
        "Algiers",
        "Almaty",
        "Amman",
        "Amsterdam",
        "Anchorage",
        "Andorra la Vella",
        "Ankara",
        "Antananarivo",
        "Apia",
        "Arnold",
        "Ashgabat",
        "Asmara",
        "Asuncion",
        "Athens",
        "Auckland",
        "Avarua",
        "Baghdad",
        "Baku",
        "Bamako",
        "Banda Aceh",
        "Bandar Seri Begawan",
        "Bandung",
        "Bangkok",
        "Bangui",
        "Banjul",
        "Barcelona",
        "Barranquilla",
        "Basrah",
        "Basse-Terre",
        "Basseterre",
        "Beijing",
        "Beirut",
        "Bekasi",
        "Belem",
        "Belgrade",
        "Belmopan",
        "Belo Horizonte",
        "Bengaluru",
        "Berlin",
        "Bern",
        "Bishkek",
        "Bissau",
        "Bogota",
        "Brasilia",
        "Bratislava",
        "Brazzaville",
        "Bridgetown",
        "Brisbane",
        "Brussels",
        "Bucharest",
        "Budapest",
        "Buenos Aires",
        "Bujumbura",
        "Bursa",
        "Busan",
        "Cairo",
        "Cali",
        "Caloocan",
        "Camayenne",
        "Canberra",
        "Cape Town",
        "Caracas",
        "Casablanca",
        "Castries",
        "Cayenne",
        "Charlotte Amalie",
        "Chengdu",
        "Chennai",
        "Chicago",
        "Chisinau",
        "Chittagong",
        "Chongqing",
        "Colombo",
        "Conakry",
        //#region Danske Byer
        "Copenhagen",
        "Aarhus",
        "Odense",
        "Aalborg",
        "Esbjerg",
        "Randers",
        "Horsens",
        "Kolding",
        "Vejle",
        "Roskilde",
        "Herning",
        "Silkeborg",
        "HÃ¸rsholm",
        "HelsingÃ¸r",
        "NÃ¦stved",
        "Viborg",
        "Fredericia",
        "KÃ¸ge",
        "Holstebro",
        "Taastrup",
        "HillerÃ¸d",
        "Slagelse",
        "HolbÃ¦k",
        "SÃ¸nderborg",
        "Svendborg",
        "HjÃ¸rring",
        "NÃ¸rresundby",
        "Ringsted",
        "Ã˜lstykke",
        "StenlÃ¸se",
        "Frederikshavn",
        "Haderslev",
        "SmÃ¸rumnedre",
        "BirkerÃ¸d",
        "Farum",
        "Skive",
        "Skanderborg",
        "Nyborg",
        "SolrÃ¸dStrand",
        "Frederikssund",
        "NykÃ¸bingF",
        "LillerÃ¸d",
        "Aabenraa",
        "Middelfart",
        "Kalundborg",
        "Ikast",
        "Hedehusene",
        "FlÃ¸ng",
        "KorsÃ¸r",
        "Grenaa",
        "Varde",
        "RÃ¸nne",
        "Thisted",
        "VÃ¦rlÃ¸se",
        "Odder",
        "BrÃ¸nderslev",
        "FrederiksvÃ¦rk",
        "Hedensted",
        "LÃ¸sning",
        "Nakskov",
        "DragÃ¸r",
        "Haslev",
        "Hobro",
        "Vordingborg",
        "Jyllinge",
        "Lystrup",
        "Vejen",
        "Struer",
        "RingkÃ¸bing",
        "HumlebÃ¦k",
        "Grindsted",
        "Beder",
        "Malling",
        "StÃ¸vring",
        "Galten",
        "Skovby",
        "NykÃ¸bingM",
        "Fredensborg",
        "Helsinge",
        "SÃ¦by",
        "Aars",
        "LÃ¸gten",
        "SkÃ¸dstrup",
        "Hundested",
        "HÃ¸rning",
        "Ribe",
        "Hinnerup",
        "Hadsten",
        "NivÃ¥",
        "SorÃ¸",
        "Skjern",
        "Svenstrup",
        "TÃ¸nder",
        "Skagen",
        "Bjerringbro",
        "Brande",
        "Vojens",
        "Ry",
        "Ebeltoft",
        "Bramming",
        "Billund",
        "Hammel",
        "Faaborg",
        "Lemvig",
        "Slangerup",
        "Gilleleje",
        "Ringe",
        "Aabybro",
        "SkÃ¦lskÃ¸r",
        "BÃ¸rkop",
        "Hornslet",
        "Assens",
        "Kerteminde",
        "RÃ¸dekro",
        "Bellinge",
        "HellebÃ¦k",
        "Ã…lsgÃ¥rde",
        "Nordborg",
        "Maribo",
        "Nibe",
        "Hirtshals",
        "Munkebo",
        "HornbÃ¦k",
        "DronningmÃ¸lle",
        "Tune",
        "Otterup",
        "Kjellerup",
        "Fensmark",
        "MÃ¥rslet",
        "Klarup",
        "NykÃ¸bingS",
        "StrÃ¸byEgede",
        "Hadsund",
        "Strib",
        "Vamdrup",
        "Borup",
        "Vodskov",
        "VibyS",
        "Solbjerg",
        "Give",
        "RudkÃ¸bing",
        "BrÃ¸rup",
        "Sejs",
        "SvejbÃ¦k",
        "SakskÃ¸bing",
        "Havdrup",
        "Hjallerup",
        "GrÃ¥sten",
        "HÃ¸ng",
        "KirkeHvalsÃ¸",
        "Padborg",
        "Jyderup",
        "Svogerslev",
        "Sunds",
        "Langeskov",
        "VidebÃ¦k",
        "Ã…rslev",
        "Faxe",
        "Lynge",
        "UggelÃ¸se",
        "Tarm",
        "JÃ¦gerspris",
        "Bogense",
        "Dianalund",
        "Vildbjerg",
        "Juelsminde",
        "BrÃ¦dstrup",
        "Harlev",
        "LÃ¸gstÃ¸r",
        "Frederiksberg",
        "TÃ¸llÃ¸se",
        "PrÃ¦stÃ¸",
        "Assentoft",
        "Ã˜lgod",
        "Jelling",
        "Stege",
        "Virklund",
        "NexÃ¸",
        "StoreHeddinge",
        "Gistrup",
        "HjortshÃ¸j",
        "GrÃ¦sted",
        "Dronninglund",
        "Taulov",
        "Storvorde",
        "LÃ¸gumkloster",
        "FarsÃ¸",
        "Glamsbjerg",
        "ThurÃ¸By",
        "Fjerritslev",
        "Sabro",
        "Vissenbjerg",
        "RÃ¸nde",
        "SÃ¸ndersÃ¸",
        "Broager",
        "Toftlund",
        "Aulum",
        "Trige",
        "NÃ¸rreAaby",
        "SkÃ¦rbÃ¦k",
        "Aarup",
        "Lund",
        "Sundby",
        "Frejlev",
        "Augustenborg",
        "Auning",
        "BjÃ¦verskov",
        "SÃ¸ften",
        "AsnÃ¦s",
        "Lejre",
        "Skibby",
        "Ejby",
        "Vindinge",
        "Sindal",
        "Brejning",
        "SanktKlemens",
        "Vinderup",
        "Holsted",
        "SkÃ¸rping",
        "Egebjerg",
        "BlovstrÃ¸d",
        "Christiansfeld",
        "Lunderskov",
        "TÃ¸rring",
        "Pandrup",
        "TjÃ¦reborg",
        "HÃ¥rlev",
        "GanlÃ¸se",
        "Vestbjerg",
        "LangÃ¥",
        "SkÃ¦vinge",
        "HÃ¸jslevStationsby",
        "OksbÃ¸l",
        "HvideSande",
        "Svinninge",
        "Aalestrup",
        "RÃ¸dding",
        "RÃ¸nnede",
        "Nordby",
        "Tinglev",
        "GundsÃ¸magle",
        "Hurup",
        "HÃ¸ruphav",
        "RyomgÃ¥rd",
        "Brovst",
        "KibÃ¦k",
        "Skibet",
        "Ullerslev",
        "VrÃ¥",
        "Ã˜stbirk",
        "Mariager",
        "Forlev",
        "Stoholm",
        "VesterHassing",
        "Vadum",
        "Arden",
        "Stevnstrup",
        "Haarby",
        "Hals",
        "Liseleje",
        "Starup",
        "NyrÃ¥d",
        "FaxeLadeplads",
        "Gram",
        "Guderup",
        "HÃ¸rve",
        "KÃ¥s",
        //#endregion
        "Cordoba",
        "Curitiba",
        "Daegu",
        "Daejeon",
        "Dakar",
        "Dallas",
        "Damascus",
        "Dar es Salaam",
        "Delhi",
        "Denver",
        "Dhaka",
        "Dili",
        "Djibouti",
        "Dodoma",
        "Doha",
        "Dongguan",
        "Douala",
        "Douglas",
        "Dubai",
        "Dublin",
        "Durban",
        "Dushanbe",
        "Faisalabad",
        "Fort-de-France",
        "Fortaleza",
        "Freetown",
        "Fukuoka",
        "Funafuti",
        "Gaborone",
        "George Town",
        "Georgetown",
        "Gibraltar",
        "Gitega",
        "Giza",
        "Guadalajara",
        "Guangzhou",
        "Guatemala City",
        "Guayaquil",
        "Gujranwala",
        "Gustavia",
        "Gwangju",
        "Hamburg",
        "Hanoi",
        "Harare",
        "Havana",
        "Helsinki",
        "Ho Chi Minh City",
        "Hong Kong",
        "Honiara",
        "Honolulu",
        "Houston",
        "Hyderabad",
        "Hyderabad",
        "Ibadan",
        "Incheon",
        "Isfahan",
        "Islamabad",
        "Istanbul",
        "Izmir",
        "Jaipur",
        "Jakarta",
        "Jeddah",
        "Jerusalem",
        "Johannesburg",
        "Juarez",
        "Juba",
        "Kabul",
        "Kaduna",
        "Kampala",
        "Kano",
        "Kanpur",
        "Kaohsiung",
        "Karachi",
        "Karaj",
        "Kathmandu",
        "Kawasaki",
        "Kharkiv",
        "Khartoum",
        "Khulna",
        "Kigali",
        "Kingsburg",
        "Kingston",
        "Kingstown",
        "Kinshasa",
        "Kobe",
        "Kolkata",
        "Kota Bharu",
        "Kowloon",
        "Kuala Lumpur",
        "Kumasi",
        "Kuwait",
        "Kyiv",
        "Kyoto",
        "La Paz",
        "Lagos",
        "Lahore",
        "Libreville",
        "Lilongwe",
        "Lima",
        "Lisbon",
        "Ljubljana",
        "Lome",
        "London",
        "Los Angeles",
        "Luanda",
        "Lubumbashi",
        "Lusaka",
        "Luxembourg",
        "Macau",
        "Madrid",
        "Majuro",
        "Makassar",
        "Malabo",
        "Male",
        "Mamoudzou",
        "Managua",
        "Manama",
        "Manaus",
        "Manila",
        "Maputo",
        "Maracaibo",
        "Maracay",
        "Mariehamn",
        "Marigot",
        "Maseru",
        "Mashhad",
        "Mbabane",
        "Mecca",
        "Medan",
        "Medellin",
        "Medina",
        "Melbourne",
        "Mexico City",
        "Miami",
        "Minsk",
        "Mogadishu",
        "Monaco",
        "Monrovia",
        "Montevideo",
        "Montreal",
        "Moroni",
        "Moscow",
        "Mosul",
        "Multan",
        "Mumbai",
        "Muscat",
        "N'Djamena",
        "Nagoya",
        "Nairobi",
        "Nanchong",
        "Nanjing",
        "Nassau",
        "Nay Pyi Taw",
        "New York",
        "Niamey",
        "Nicosia",
        "Nouakchott",
        "Noumea",
        "Novosibirsk",
        "Nuku'alofa",
        "Nur-Sultan",
        "Nuuk",
        "Oranjestad",
        "Osaka",
        "Oslo",
        "Ottawa",
        "Ouagadougou",
        "Pago Pago",
        "Palembang",
        "Palo Alto",
        "Panama",
        "Papeete",
        "Paramaribo",
        "Paris",
        "Perth",
        "Philadelphia",
        "Phnom Penh",
        "Phoenix",
        "Podgorica",
        "Port Louis",
        "Port Moresby",
        "Port of Spain",
        "Port-Vila",
        "Port-au-Prince",
        "Porto Alegre",
        "Porto-Novo",
        "Prague",
        "Praia",
        "Pretoria",
        "Pristina",
        "Puebla",
        "Pune",
        "Pyongyang",
        "Quezon City",
        "Quito",
        "Rabat",
        "Rawalpindi",
        "Recife",
        "Reykjavik",
        "Riga",
        "Rio de Janeiro",
        "Riyadh",
        "Road Town",
        "Rome",
        "Roseau",
        "Saint George's",
        "Saint Helier",
        "Saint John's",
        "Saint Peter Port",
        "Saint Petersburg",
        "Saint-Denis",
        "Saint-Pierre",
        "Saipan",
        "Salvador",
        "San Antonio",
        "San Diego",
        "San Francisco",
        "San Jose",
        "San Juan",
        "San Marino",
        "San Salvador",
        "Sanaa",
        "Santa Cruz de la Sierra",
        "Santiago",
        "Santo Domingo",
        "Sao Paulo",
        "Sao Tome",
        "Sapporo",
        "Sarajevo",
        "Seattle",
        "Semarang",
        "Seoul",
        "Shanghai",
        "Sharjah",
        "Shenzhen",
        "Singapore",
        "Skopje",
        "Sofia",
        "South Tangerang",
        "Soweto",
        "Stockholm",
        "Sucre",
        "Surabaya",
        "Surat",
        "Suva",
        "Sydney",
        "Tabriz",
        "Taipei",
        "Tallinn",
        "Tangerang",
        "Tarawa",
        "Tashkent",
        "Tbilisi",
        "Tegucigalpa",
        "Tehran",
        "Tel Aviv",
        "Thimphu",
        "Tianjin",
        "Tijuana",
        "Tirana",
        "Tokyo",
        "Toronto",
        "Torshavn",
        "Tripoli",
        "Tunis",
        "Ulan Bator",
        "Vaduz",
        "Valencia",
        "Valletta",
        "Vancouver",
        "Victoria",
        "Vienna",
        "Vientiane",
        "Vilnius",
        "Warsaw",
        "Washington",
        "Wellington",
        "Willemstad",
        "Windhoek",
        "Wuhan",
        "Xi'an",
        "Yamoussoukro",
        "Yangon",
        "Yaounde",
        "Yekaterinburg",
        "Yerevan",
        "Yokohama",
        "Zagreb",
    ];
    const CITY_LIST = document.getElementById('suggestions');
    CITY_LIST.innerHTML = '';
    CITY_NAMES.forEach(city => {
        const option = document.createElement('option');
        option.value = city;
        CITY_LIST.appendChild(option);
    });

    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const city = urlParams.get('city');
    console.log(`Search Parameter: ${city}`);
    GetWeatherByCity(city);
}


const SummerTemp = 25;
const WinterTemp = 0;
function ShowDataOnPage(data) {
    let icon = document.getElementById("icon");
    let temp = document.getElementById("temp");
    let img = document.createElement("img");
    let caculation = data.main.temp - 273.15;
    img.setAttribute("class", "icon");
    img.setAttribute("src", "./assets/img/"+data.weather[0].icon+".png");
    img.setAttribute("id", "img");
    icon.appendChild(img);

    let celsius = Math.round(caculation);

    temp.innerText = `${data.name} Temperature ${celsius}Â°C`;
    if(celsius > SummerTemp) {
        temp.innerText += "\nSummer Weather! ğŸ–ï¸â˜€ï¸"
    }
    else if (celsius < WinterTemp) {
        temp.innerText += "\nWinter Weather! â„ï¸ğŸŒ¨ï¸"
    }
    ShowTableData(data);
}   

function LoadTableData(data) {
    let table = document.getElementById("weathertable");
    let timeRows = {}; 
    let days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
    
    data.list.forEach(x => {
        let date = new Date(x.dt_txt.split(' ')[0]);
        let dayName = days[date.getDay()];
        let time = x.dt_txt.split(' ')[1];
        let temperature = Math.round(x.main.temp - 273.15);
        if (!timeRows[time]) {
            timeRows[time] = { time: time, temperatures: {} };
        }
        timeRows[time].temperatures[dayName] = `${temperature}Â°C`;
    });

    let headerRow = document.createElement("tr");
    headerRow.appendChild(document.createElement("th"));
    days.forEach(day => {
        let th = document.createElement("th");
        th.innerText = day;
        headerRow.appendChild(th);
    });
    table.appendChild(headerRow);

    Object.keys(timeRows).forEach(time => {
        let trtime = document.createElement("tr");
        let tdTime = document.createElement("td");
        tdTime.innerText = time;
        trtime.appendChild(tdTime);

        days.forEach(day => {
            let td = document.createElement("td");
            td.innerText = timeRows[time].temperatures[day] || '--';
            trtime.appendChild(td);
        });

        table.appendChild(trtime);
    });
}


function ShowTableData(data) {
    let APIURL = `https://api.openweathermap.org/data/2.5/forecast?lat=${data.coord.lat}&lon=${data.coord.lon}&appid=${API_KEY}`;
   

    fetch(APIURL)
    .then(function(responce) {
        return responce.json();
    }).then(function(data) {
        console.log(data);
        LoadTableData(data);
    }).catch(function(error) {
        console.log(error);
    });
}



window.onload = () => {
    LoadCityData();
};